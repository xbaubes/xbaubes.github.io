<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Xavier Baubes">
    <meta name="description" content="Lloc web on trobaràs material de docència informàtica actualitzat i en català">
    <meta name="keywords" content="SMX, DAM, DAW, ASIX, FP, cicle formatiu, informatica, CSS, HTML, Javascript, FTP, git, xarxes, sistemes, bases de dades, aplicacions, web, desenvolupament, programacio">
    <!-- <meta name="title" content="Template"> -->
    <title>Docència informàtica</title>
    <link rel="shortcut icon" type="image/x-icon" href="../../../assets/icons/frontend-web-logo.ico">
    <link rel="stylesheet" href="../../../assets/css/main.css">
    <link rel="stylesheet" href="../../../assets/css/module.css">
    <link rel="stylesheet" href="../../../assets/css/pages.css">
    <script src="../../../data/module.js" type="text/javascript"></script>
    <script src="../../../data/strings.js" type="text/javascript"></script>
    <script src="../../../assets/js/components.js" type="text/javascript" defer></script>
    <script src="../../../assets/js/componentsContent.js" type="text/javascript" defer></script>
    <script src="fullAPI.js" type="text/javascript" defer></script>

</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WLW0ETK1PT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WLW0ETK1PT');
</script>
<body>

    <nav class="icon-container icon-container-module-content"></nav>

    <main>

        <article>

            <h1 class="titleBar">
                <div id="txtBar"></div>
                <div class="dropdown">
                    <img id="imgBar" src="../../../assets/icons/chevron-down-color.svg" alt="Desplegable" class="chevron-icon">
                    <div id="mainNav" class="dropdown-content"></div>
                </div>
            </h1>

            <section class="menu">
                <ul>
                    <li><a href="#id1">Utilitat</a></li>
                    <li><a href="#id2">Funcionament</a></li>
                    <li><a href="#id3">Exemple d'ús</a></li>
                    <li><a href="#id4">Explicació del codi</a></li>
                    <li><a href="#id5">Crides a l'API</a></li>
                </ul>
            </section>

            <section id="intro" class="content">

				<div class="small-float-image-container">
					<img src="sheetDB-logo.png"
					alt="Instal·lació de canaleta amb cables elèctrics i Ethernet clavat a una fusta">
				</div>
                <p>
                    Eines com <strong>SheetDB</strong> són útils perquè converteixen un full de càlcul
                    en una <a href="https://xbaubes.github.io/modules/desenvolupaweb/apirest/apirest.html?page=API%20REST"><strong>API REST</strong></a>
					<br>
					Una API RESTful és un servei web amb el qual pots comunicar-te per:
					<br>
                    <em>Llegir,</em>
					<em>afegir,</em>
					<em>editar</em>
					<em>i eliminar</em>
					dades utilitzant crides HTTP
                    (<code>GET</code>, <code>POST</code>, <code>PUT/PATCH</code> i <code>DELETE</code>).
                </p>

                <p>En lloc d’haver de:</p>
                <ul>
                    <li>Configurar un servidor propi</li>
                    <li>Escriure codi backend</li>
                    <li>Gestionar una base de dades tradicional</li>
                </ul>

                <p>
                    Pots aprofitar <strong>Google Sheets</strong> com a <strong>magatzem de dades</strong> i fer-lo accessible de manera estructurada i estandaritzada.
                </p>
            </section>
            
            <section id="id1" class="content">
                <h3>Utilitat</h3>

                <p><strong>Simplicitat</strong></p>
                <ul>
                    <li>No cal saber backend ni SQL per tenir un sistema de dades compartit.</li>
                    <li>L'usuari pot modificar les dades directament al full de càlcul.</li>
                </ul>

                <p><strong>Integració fàcil</strong></p>
                <ul>
                    <li>Qualsevol aplicació web, app mòbil o script pot consumir o enviar dades a través de l’API.</li>
                    <li>Funciona amb JavaScript al navegador, Python, PHP, etc.</li>
                </ul>

                <p><strong>Col·laboració</strong></p>
                <ul>
                    <li>El full es pot editar per múltiples persones alhora i les actualitzacions són immediates a l’API.</li>
                </ul>

                <p><strong>Versatilitat</strong></p>
                <ul>
                    <li>Serveix tant per projectes petits com per prototips d’aplicacions més grans.</li>
                </ul>
            </section>

            <section id="id2" class="content">
                <h3>Funcionament</h3>
                <ol>
                    <li>
						Crees el full de càlcul amb les columnes (capçaleres) a la primera fila, els registres amb les dades els posarem a partir de la segona línia.
						<br>Pots utilitzar Google Sheets, que s'emmagatzema automàticament a Google Drive. Cal que sigui públic, almenys per lectura, per tal que SheetDB hi pugui accedir.
						<br>Si vols utilitzar diferents taules per la teva API, pots separar-les en diferents fulls, utilitzant l'atribut <a href="https://docs.sheetdb.io/multiple-sheets" target="_blank"><em>sheet</em></a>.
					</li>
                    <li>
						El connectes a SheetDB i obtens una URL d’API. Pots crear-la des de la pàgina web oficial de <a href="https://sheetdb.io/" target="_blank">SheetDB</a>.
						<br>Tot queda sincronitzat amb el full en temps real.
					</li>
                    <li>
                    Pots activar els mètodes HTTP que t'interessin:
                    <ul>
                        <li><code>GET</code>: Obtenir dades</li>
                        <li><code>POST</code>: Afegir noves files</li>
                        <li><code>PUT/PATCH</code>: Modificar files existents</li>
                        <li><code>DELETE</code>: Esborrar files</li>
                    </ul>
                    </li>
					Si vols que SheetDB hi pugui fer canvis al teu full de càlcul, per exemple per implementar POST, li hauràs de donar permís.
					<li>SheetDB crea un endpoint per cada mètode HTTP. Si hi fas una crida HTTP rebràs un resposta en format JSON amb les dades sol·licitades.</li>
                </ol>
				
				<div class="medium-image-container">
					<img src="sheetDB-schema.png"
					alt="Funcionament SheetDB">
				</div>
				
            </section>

            <section id="id3" class="content">
                <h3>Exemple d'ús: Cercador d'elements químics</h3>

                <p>A través d'aquest formulari HTML podem cercar i visualitzar elements químics. SheetDB permet generar un token per restringir l'accés als endpoints però com que no es pot enviar amb seguretat des d'un navegador web, aquest aplicació no n'utilitza i només permet GET.</p>
                <p>El formulari obté la informació a través d'un full de càlcul connectat a <strong>SheetDB</strong> (Google Sheets convertit en API REST).</p>
                <p>
                    Aquestes dades s'obtenen d'un
                    <a href="https://docs.google.com/spreadsheets/d/1izf8-enZhMFNLQ7UC1Mp3R2ltVBT0gCZ4ItjDtiFVJs/edit?usp=sharing" target="_blank">
                        Google Sheets
                    </a>.
                </p>
                <p>
                    I pots veure les <a href="https://sheetdb.io/api/v1/q4eo36ocdijgf" target="_blank">dades en format JSON</a> que retorna el servei API REST.

					<br>Les dades es poden sol·licitar ordenades per qualsevol camp utilitzant <a href="https://docs.sheetdb.io/sheetdb-api/read#get-content" target="_blank">sort_by i sort_order</a>.

                </p>

                <ul>
                    <li>L'usuari pot introduir valors als camps del formulari per tal de filtar pels elements que li interessen:
                        <ul>
                            <li>Número atòmic</li>
                            <li>Nom</li>
                            <li>Símbol químic</li>
                            <li>Estat a temperatura ambient</li>
                        </ul>
                    </li>
                    <li>Quan es prem el botó <em>Cercar</em> s'envien les dades sense recarregar la pàgina:
                        <ul>
                            <li>Es llegeixen només els camps que tenen valor i es codifiquen per a URL.</li>
                            <li>Es construeix la URL de consulta a l'API de SheetDB, afegint paràmetres <code>/search?camp=valor</code>.</li>
                        </ul>
                    </li>
                    <li>El codi fa una petició HTTP GET a la URL construïda:
                        <ul>
                            <li>Si la resposta és correcta, la converteix a JSON.</li>
                            <li>Crea dinàmicament una taula HTML i l'omple amb:
                            <ul>
                                <li>Capçalera amb els noms de les columnes rebudes.</li>
                                <li>Files amb els valors rebuts.</li>
                            </ul>
                            </li>
                            <li>Finalment, insereix aquesta taula dins del contingut de la pàgina web.</li>
                        </ul>
                    </li>
                </ul>
                <br>

                <div id="exempleFullAPI">
                    <form id="searchForm">
                        <label for="numAtomic">Número atòmic:</label>
                        <input type="number" id="numAtomic" name="Número atòmic" min="1" max="118">

                        <label for="element">Nom:</label>
                        <input type="text" id="element" name="Element">

                        <label for="simbol">Símbol químic:</label>
                        <input type="text" id="simbol" name="Símbol">

                        <label for="estat">Estat a temperatura ambient:</label>
                        <select id="estat" name="Estat a temperatura ambient">
                            <option value="">-- Qualsevol --</option> <!-- enviem cadena buida si es selecciona aquesta opcio -->
                            <option value="Sòlid">Sòlid</option>
                            <option value="Líquid">Líquid</option>
                            <option value="Gas">Gas</option>
                        </select>

                        <button type="submit">Cercar</button>
                    </form>

                    <div id="results"></div>
                </div>
            </section>

            <section id="id4" class="content">
                <h3>Explicació del codi</h3>

				<div>
				  <strong><a href="https://github.com/xbaubes/xbaubes.github.io/blob/main/modules/aplicainfo/fullAPI/fullAPI.html" target="_blank">
                        HTML
                  </a></strong>
				  <p>Els inputs utilitzen tipus específics (<code>type="number"</code> i <code>type="text"</code>) per validar, des del navegador, el format de l'entrada.</p>

				  <p>El <code>&lt;select&gt;</code> proporciona una llista d’opcions predefinides, amb una opció inicial de cadena buida per indicar que no es filtra per aquest camp.</p>

				  <p>Cada control està associat a un atribut <code>name</code> que el fa identificable des de JavaScript.</p>

				  <p>Es defineix un <code>&lt;div&gt;</code> a sota com a contenidor on es mostraran els resultats de la petició.</p>

				  <p>El botó <code>type="submit"</code> desencadena l’esdeveniment d'enviament del formulari.</p>
				</div>

				<div>
				  <strong><a href="https://github.com/xbaubes/xbaubes.github.io/blob/main/modules/aplicainfo/fullAPI/fullAPI.js" target="_blank">
                        JavaScript
                  </a></strong>
				  <p>L'esdeveniment d'enviament del formulari es captura usant JavaScript amb <code>addEventListener("submit", ...)</code>.</p>

				  <p>Amb la instrucció <code>e.preventDefault()</code> s'evita que el navegador recarregui la pàgina i enviï el formulari via HTTP estàndard.</p>

				  <p><code>this.elements</code> és la col·lecció de tots els elements del formulari (<code>input</code> i <code>select</code> en aquest cas).</p>

				  <p>Per sanejar les dades, apliquem <code>value.trim()</code> per eliminar els espais inicials i finals, i amb <code>encodeURIComponent</code> formategem l'string per enviar-lo com a URL.</p>

				  <p>Si hi ha paràmetres, s’afegeix <code>/search?</code> a la query string generada, indicant que es farà una petició GET amb filtres. Els paràmetres es concatenen amb <code>&amp;</code>.</p>

				  <p>Es realitza una petició asíncrona a l’API: Usant <code>fetch(url)</code> per obtenir les dades.</p>

				  <p>Amb la funció asíncrona <code>.json()</code> es converteix la resposta HTTP en un objecte JavaScript.</p>

				  <p>A través de la manipulació del DOM, les dades s'insereixen en format <code>&lt;table&gt;</code> al <code>&lt;div&gt;</code> definit a l'HTML. Per analitzar pas a pas aquest procés i la crida a l'API, el codi inclou <code>console.log</code>, els resultats que retorna es poden veure inspeccionant la pàgina i accedint a la pestanya "Console".</p>
				</div>

            </section>

            <section id="id5" class="content">
                <h3>Crides a l'API</h3>
				<div>
					<p>Un exemple dels endpoints que facilita l'aplicació per cada mètode HTTP, els endpoints sempre retornen files completes. Informació obtinguda de la <a href="https://docs.sheetdb.io/" target="_blank">documentació oficial</a>.</p>
					<ul>
						<li>
							<strong>GET</strong> Obtenir totes les dades:<br>
							<code>/</code><br>
							<span class="text-ressaltat">https://sheetdb.io/api/v1/ID_FULL_SHEETDB</span>
						</li>
						<li>
							<strong>GET</strong> Cercar dades per camps:<br>
							<code>/search?...</code><br>
							Cercar les dades de la usuària de nom Maria:<br>
							<span class="text-ressaltat">
								https://sheetdb.io/api/v1/ID_FULL_SHEETDB/search?nom=Maria
							</span>
						</li>
						<li>
							<strong>POST</strong> Afegir fila nova:<br>
							<code>/</code><br>
							<span class="text-ressaltat">
								https://sheetdb.io/api/v1/ID_FULL_SHEETDB
							</span>
						</li>
						<li>
							<strong>PATCH / PUT</strong> Actualitzar dades:<br>
							<code>/id/{valor}</code><br>
							Actualitzar les dades de l'usuari amb id=3:<br>
							<span class="text-ressaltat">
								https://sheetdb.io/api/v1/ID_FULL_SHEETDB/id/3
							</span>
						</li>
						<li>
							<strong>DELETE</strong> Esborrar dades:<br>
							<code>/id/{valor}</code><br>
							Esborrar l'usuari amb id=3:<br>
							<span class="text-ressaltat">
								https://sheetdb.io/api/v1/ID_FULL_SHEETDB/id/3
							</span>
						</li>
					</ul>
					
					<p>Exemple de crida POST a un endpoint de l'API:
					
					<pre><code>
	const resposta = await fetch(API_ENDPOINT, {
		method: "POST",
		headers: { "Content-Type": "application/json" },
		body: JSON.stringify({
			data: [{ nom: "Joan", data: "1977-05-12" }]
		})
	});
	const data = await resposta.json();
	console.log("POST:", data);
					</code></pre>
					
				</div>
            </section>

        </article>

        <footer></footer>

    </main>

    <div class="scroll-to-top"></div>

</body>
</html>
